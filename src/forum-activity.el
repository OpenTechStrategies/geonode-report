;; Elisp to created input files for gnuplot.

(defun activity-by-date ()
  "Convert forum activity data lines into gnuplot input.
Invoke this in the leftmost column at the top of a series of lines,
each line in the format DATE TOTAL_POSTS TOTAL_VIEWS (most likely
created via Emacs macro from, e.g., ../data/geonode-users-stats).

A buffer named \"u-tmp\" must exist or this function will raise an
error.  After the function is done, buffer \"u-tmp\" contains the data
you want.  Yes, I know that's clunky.  I might improve it later, but
for now I'd like to concentrate on wrestling with gnuplot."
  (interactive)
  (save-excursion
    (let ((posts-by-date (make-hash-table :size 700))
          (views-by-date (make-hash-table :size 700))
          (posts-output  (find-file-noselect "forum-activity-posts.in"))
          (views-output  (find-file-noselect "forum-activity-views.in")))
      (while (looking-at "^201[0-9]+ ")
        (let* ((date
                (string-to-number
                 (buffer-substring-no-properties
                  (point) (prog2 (forward-char 6) (point) (forward-char 3)))))
               (posts
                (string-to-number
                 (buffer-substring-no-properties
                  (point) (prog2 (forward-word 1) (point) (forward-char 1)))))
               (views
                (string-to-number
                 (buffer-substring-no-properties
                  (point) (prog2 (forward-word 1) (point)))))
               (seen-posts (gethash date posts-by-date 0))
               (seen-views (gethash date views-by-date 0)))
          (puthash date (+ seen-posts posts) posts-by-date)
          (puthash date (+ seen-views views) views-by-date)
          (forward-line 1)))
      (save-excursion
        (let ((func (lambda (date num)
                      (insert (number-to-string date) " " 
                              (number-to-string num) "\n"))))
          (switch-to-buffer posts-output)
          (delete-region (point-min) (point-max))
          (maphash func posts-by-date)
          (save-buffer)
          (switch-to-buffer views-output)
          (delete-region (point-min) (point-max))
          (maphash func views-by-date)
          (save-buffer))))))
        
;;; ----------------------------------------------------------------------- ;;;
;;; everything below here is data massaged from ../data/geonode-users-stats ;;;
;;; ----------------------------------------------------------------------- ;;;

20150225 2 112
20150224 4 62
20150224 5 99
20150220 2 44
20150220 8 96
20150220 5 106
20150220 17 1083
20150219 3 88
20150219 2 45
20150219 5 17
20150218 4 36
20150213 3 71
20150212 7 18
20150211 2 3
20150211 2 54
20150210 5 338
20150210 33 239
20150209 7 38
20150208 12 227
20150206 8 65
20150206 2 40
20150206 3 34
20150206 3 55
20150206 2 47
20150203 9 58
20150203 3 9
20150202 3 21
20150202 2 48
20150129 6 60
20150128 7 19
20150126 2 28
20150122 3 78
20150122 1 30
20150122 4 93
20150122 5 59
20150122 6 95
20150120 7 256
20150120 5 48
20150119 1 10
20150119 1 5
20150118 8 27
20150116 4 35
20150116 2 27
20150116 12 191
20150115 39 59
20150115 5 16
20150114 11 134
20150114 3 187
20150113 1 35
20150113 6 62
20150112 5 42
20150112 12 86
20150112 2 22
20150108 9 92
20150108 3 25
20150107 5 12
20150105 14 155
20141230 7 47
20141229 3 28
20141226 9 74
20141218 6 29
20141217 18 885
20141217 1 15
20141216 1 11
20141216 5 33
20141215 2 16
20141212 11 95
20141211 15 62
20141211 10 29
20141209 4 11
20141209 2 253
20141208 2 6
20141208 2 53
20141207 3 20
20141205 7 18
20141204 3 12
20141204 4 17
20141204 11 74
20141204 3 15
20141203 1 29
20141203 3 6
20141128 5 142
20141128 9 58
20141127 3 41
20141127 12 69
20141127 9 37
20141127 6 8
20141127 1 11
20141125 6 31
20141125 10 97
20141125 10 48
20141125 4 92
20141124 6 67
20141123 4 15
20141121 3 17
20141121 4 35
20141121 3 55
20141119 1 4
20141119 1 11
20141117 2 13
20141116 1 30
20141114 1 8
20141112 1 13
20141109 1 21
20141107 2 9
20141031 7 33
20141029 8 74
20141024 6 15
20141024 5 10
20141024 1 9
20141024 2 72
20141022 8 19
20141021 3 55
20141021 7 24
20141020 14 89
20141018 3 46
20141016 3 145
20141015 1 4
20141015 3 32
20141015 1 22
20141015 2 12
20141014 2 10
20141014 2 16
20141014 8 24
20141013 4 14
20141013 1 22
20141013 4 18
20141013 18 1639
20141012 3 10
20141010 3 15
20141002 7 13
20141002 4 37
20140923 1 22
20140919 7 379
20140918 1 21
20140916 3 27
20140916 7 136
20140915 3 23
20140915 5 23
20140912 5 23
20140909 3 62
20140905 5 143
20140904 2 35
20140904 3 29
20140903 5 15
20140901 6 64
20140828 14 40
20140828 12 202
20140826 6 329
20140822 1 9
20140822 1 12
20140820 1 5
20140820 3 95
20140819 1 9
20140813 2 20
20140812 2 12
20140812 8 34
20140811 37 238
20140811 4 96
20140809 2 12
20140809 2 7
20140808 3 31
20140808 7 39
20140808 7 27
20140806 5 30
20140805 7 17
20140804 2 11
20140731 10 71
20140731 3 17
20140728 2 37
20140723 2 42
20140723 1 18
20140723 1 81
20140721 7 25
20140721 2 82
20140721 1 32
20140717 1 9
20140716 4 20
20140715 2 10
20140712 3 8
20140711 3 60
20140710 8 44
20140710 2 9
20140709 2 9
20140709 2 12
20140708 5 27
20140705 5 54
20140704 1 55
20140702 4 71
20140702 14 96
20140701 3 40
20140701 13 46
20140701 4 13
20140630 10 146
20140630 1 8
20140627 4 64
20140627 4 67
20140625 4 114
20140625 1 12
20140623 1 19
20140623 7 15
20140623 8 64
20140623 2 9
20140616 2 12
20140616 11 146
20140616 17 243
20140613 3 16
20140613 5 38
20140610 7 46
20140606 7 55
20140606 1 16
20140603 2 18
20140603 9 106
20140530 1 11
20140530 2 25
20140530 1 6
20140528 16 164
20140522 3 26
20140520 6 34
20140520 4 47
20140519 1 12
20140516 4 7
20140516 9 209
20140515 6 56
20140510 13 144
20140508 4 74
20140508 3 45
20140507 1 64
20140507 1 22
20140507 23 233
20140506 5 30
20140505 2 16
20140503 1 8
20140502 5 116
20140501 6 37
20140427 3 37
20140424 1 5
20140424 4 20
20140422 1 12
20140422 5 42
20140415 2 130
20140415 1 13
20140415 5 113
20140414 3 13
20140411 2 21
20140411 4 80
20140411 2 15
20140409 6 25
20140409 2 15
20140409 12 88
20140406 6 15
20140403 4 219
20140403 1 13
20140402 1 39
20140402 5 28
20140328 8 76
20140327 4 103
20140326 2 52
20140326 5 46
20140322 1 7
20140321 6 65
20140320 1 44
20140320 3 16
20140320 2 15
20140319 3 35
20140319 10 163
20140318 7 31
20140317 1 10
20140316 10 52
20140316 17 46
20140315 6 158
20140314 25 149
20140313 5 42
20140313 2 33
20140313 1 8
20140313 5 119
20140313 3 44
20140313 3 95
20140312 7 132
20140312 6 23
20140311 2 32
20140311 6 25
20140311 4 18
20140311 6 95
20140310 1 16
20140310 5 57
20140310 9 62
20140308 1 7
20140307 6 86
20140306 4 34
20140306 2 20
20140303 1 59
20140226 1 171
20140226 1 14
20140226 3 20
20140226 3 41
20140225 9 333
20140222 2 16
20140221 1 4
20140221 10 148
20140221 11 436
20140218 5 91
20140218 8 196
20140217 1 84
20140216 4 38
20140212 1 12
20140211 1 18
20140210 5 11
20140207 8 53
20140207 7 40
20140204 2 13
20140131 2 73
20140130 4 41
20140129 4 23
20140129 4 30
20140128 6 88
20140128 5 54
20140124 1 34
20140123 3 14
20140123 3 15
20140122 2 4
20140121 2 51
20140121 3 89
20140114 1 18
20140114 1 18
20140113 1 14
20140110 6 106
20140109 10 47
20140108 5 23
20140108 5 63
20140107 1 26
20140107 3 9
20140106 9 70
20140106 1 6
20140106 2 67
20140102 2 13
20131229 3 54
20131226 2 45
20131223 1 12
20131220 4 51
20131217 4 50
20131213 3 11
20131213 3 254
20131211 4 45
20131211 2 70
20131210 9 379
20131210 8 171
20131206 2 21
20131205 3 33
20131204 3 37
20131202 3 37
20131127 8 80
20131126 3 45
20131125 2 58
20131125 7 74
20131124 3 189
20131119 2 18
20131118 1 8
20131117 1 10
20131116 8 39
20131115 2 19
20131115 4 25
20131114 3 40
20131114 1 10
20131112 1 13
20131111 5 83
20131108 5 9
20131105 3 23
20131105 3 19
20131105 2 9
20131105 1 19
20131105 2 27
20131104 2 13
20131104 3 19
20131104 8 193
20131101 6 55
20131031 25 256
20131030 4 40
20131028 2 22
20131028 1 12
20131028 7 38
20131028 4 57
20131028 2 20
20131024 1 11
20131024 13 48
20131023 3 15
20131023 2 20
20131023 6 17
20131023 2 17
20131023 2 34
20131022 2 18
20131021 1 18
20131021 5 57
20131018 4 9
20131017 14 104
20131015 2 85
20131014 4 213
20131014 25 415
20131014 17 213
20131011 1 13
20131011 2 34
20131011 1 36
20131008 8 22
20131008 3 22
20131007 1 18
20131003 14 72
20131003 3 91
20131002 2 20
20131002 1 28
20131001 4 42
20130930 2 22
20130927 4 26
20130925 6 18
20130924 2 15
20130923 2 9
20130923 7 59
20130920 3 1535
20130920 4 42
20130919 3 100
20130917 3 65
20130917 2 40
20130913 2 37
20130913 2 33
20130913 2 21
20130911 5 43
20130911 1 19
20130911 4 98
20130910 1 17
20130910 2 25
20130909 8 179
20130909 2 23
20130906 8 126
20130905 1 10
20130905 1 8
20130905 1 10
20130904 5 57
20130903 3 42
20130903 3 104
20130829 1 12
20130829 2 11
20130828 6 140
20130826 4 31
20130822 4 17
20130820 2 47
20130820 2 22
20130819 3 110
20130816 3 21
20130813 17 149
20130808 8 21
20130807 2 11
20130802 10 58
20130801 2 27
20130731 3 53
20130731 7 33
20130731 3 82
20130725 3 35
20130722 3 49
20130718 4 191
20130716 2 8
20130716 1 37
20130710 2 89
20130715 5 39
20130715 11 90
20130710 1 39
20130703 1 24
20130703 3 40
20130702 4 21
20130701 4 38
20130628 2 11
20130627 4 114
20130625 2 23
20130624 7 40
20130620 11 105
20130614 1 69
20130610 1 19
20130606 5 155
20130605 2 30
20130603 2 37
20130531 2 25
20130528 2 24
20130527 6 114
20130527 11 67
20130524 2 21
20130523 2 19
20130519 1 47
20130509 1 44
20130507 17 140
20130502 7 85
20130502 4 24
20130502 2 33
20130430 2 37
20130426 1 36
20130423 10 116
20130410 8 195
20130410 7 307
20130404 1 4
20130404 3 24
20130401 1 9
20130327 6 26
20130325 1 32
20130320 3 12
20130319 10 640
20130313 3 48
20130308 4 73
20130305 1 19
20130228 13 55
20130227 5 59
20130220 14 32
20130219 1 0
20130211 7 55
20130210 6 35
20130207 4 150
20130206 6 39
20130204 4 3
20130203 4 313
20130131 17 729
20130125 4 22
20130121 5 52
20130117 4 11
20130117 1 17
20130110 14 39
20130110 2 58
20130110 4 15
20130110 2 10
20130104 3 28
20121221 6 48
20121219 2 20
20121213 2 19
20121211 2 37
20121206 1 83
20121206 1 6
20121204 2 231
20121204 3 123
20121204 1 2
20121204 2 8
20121203 2 17
20121130 15 128
20121113 3 46
20121109 3 38
20121108 5 24
20121106 6 53
20121106 5 282
20121031 25 860
20121031 2 9
20121031 4 29
20121029 1 6
20121029 2 41
20121028 6 132
20121027 1 13
20121023 5 9
20121018 3 75
20121010 1 7
20121010 2 12
20121010 1 3
20121008 2 25
20121008 4 92
20121004 8 34
20121004 5 56
20121004 3 15
20120928 6 25
20120927 1 7
20120926 5 29
20120925 1 11
20120925 2 7
20120924 21 189
20120918 4 99
20120914 3 46
20120911 2 28
20120908 3 115
20120907 1 19
20120823 7 61
20120822 3 87
20120821 7 69
20120820 4 85
20120814 1 105
20120814 2 42
20120806 4 16
20120730 11 150
20120730 8 34
20120730 8 194
20120724 4 135
20120719 2 33
20120719 3 20
20120717 3 13
20120716 2 7
20120713 4 11
20120713 5 14
20120712 7 26
20120712 1 9
20120711 1 18
20120710 2 68
20120710 5 217
20120706 1 24
20120705 1 6
20120703 5 202
20120703 3 15
20120703 4 71
20120701 2 8
20120625 2 11
20120625 1 4
20120625 14 149
20120625 1 9
20120625 15 64
20120625 7 95
20120624 1 3
20120622 3 307
20120622 1 12
20120621 1 1
20120619 1 36
20120619 11 520
20120618 5 22
20120615 8 5
20120614 6 7
